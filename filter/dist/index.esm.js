import*as e from"react";import{forwardRef as t,useState as r,useMemo as a,useEffect as n}from"react";import{Slot as s}from"@radix-ui/react-slot";import{cva as o}from"class-variance-authority";import{clsx as i}from"clsx";import{twMerge as l}from"tailwind-merge";import{FontAwesomeIcon as d}from"@fortawesome/react-fontawesome";import{jsxs as c,jsx as u,Fragment as m}from"react/jsx-runtime";import*as p from"@radix-ui/react-popover";import{config as f,library as h}from"@fortawesome/fontawesome-svg-core";import{faCheck as y,faXmark as g,faFilter as x}from"@fortawesome/free-solid-svg-icons";import*as v from"@radix-ui/react-select";import*as b from"@radix-ui/react-switch";import*as w from"@radix-ui/react-tooltip";import{Command as N}from"cmdk";import{DayPicker as C}from"react-day-picker";import{format as k}from"date-fns";function $(...e){return l(i(e))}const S=({className:e})=>u(d,{icon:"spinner",className:$("animate-spin text-primary-600",e)}),A=t(({selected:e,leftIcon:t,rightIcon:r,className:a,iconClassName:n,placeholder:s,maxWidth:o="max-w-20",...i},l)=>c("button",{ref:l,className:$("flex items-center border-b pb-1 px-2 text-gray-500 text-sm font-light cursor-pointer min-w-0 overflow-hidden",a),...i,children:[c("div",{className:"flex text-start items-center justify-center truncate min-w-0",children:[t&&u(d,{icon:t,className:$("h-3 w-3 text-secondary-500 flex-shrink-0",n)}),u("span",{className:`truncate min-w-0 ${o} ${t?"pl-1":""}`,children:e&&e.length?Array.isArray(e)?`${e.length} selected`:e.label:s})]}),r&&u(d,{icon:r,className:"h-3 w-3 pl-1 flex-shrink-0"})]}));A.displayName="SelectTrigger";const M=o("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary-700 text-primary-50 shadow hover:bg-primary-800",danger:"bg-red-700 text-red-50 shadow-sm hover:bg-red-800",outline:"border border-input shadow-sm hover:bg-gray-100",secondary:"bg-secondary-700 text-secondary-50 shadow-sm hover:bg-secondary-800",ghost:"hover:bg-primary-50",link:"text-primary-800 underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),D=t(({className:e,variant:t,size:r,asChild:a=!1,loading:n=!1,children:o,...i},l)=>{const d=a?s:"button",p=a?c("span",{className:"inline-flex items-center",children:[n&&u(S,{className:"mr-2 h-4 w-4 animate-spin text-current"}),o]}):c(m,{children:[n&&u(S,{className:"mr-2 h-4 w-4 animate-spin text-current"}),o]});return u(d,{className:$(M({variant:t,size:r,className:e})),title:i.title,ref:l,disabled:i.disabled||n,...i,children:p})});D.displayName="Button";const _=e.forwardRef(({className:e,type:t,...r},a)=>u("input",{type:t,className:$("flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));_.displayName="Input";const O=p.Root,R=p.Trigger,L=e.forwardRef(({className:e,align:t="center",sideOffset:r=4,...a},n)=>u(p.Portal,{children:u(p.Content,{ref:n,align:t,sideOffset:r,className:$("bg-popover text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));L.displayName=p.Content.displayName,f.autoAddCss=!1,h.add(y,g,x);const T=v.Root,I=v.Value,j=e.forwardRef(({iconClassName:e,className:t,isIconShow:r=!0,children:a,...n},s)=>c(v.Trigger,{ref:s,className:$("flex h-9 w-full items-center whitespace-nowrap rounded-sm border bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...n,children:[u(v.Icon,{asChild:!0,children:r&&u(d,{icon:"sort",className:$("mr-2 w-4 h-4",e)})}),a]}));j.displayName=v.Trigger.displayName;const F=e.forwardRef(({className:e,...t},r)=>u(v.ScrollUpButton,{ref:r,className:$("flex justify-center items-center py-1 cursor-default",e),...t,children:u(d,{icon:"chevron-up"})}));F.displayName=v.ScrollUpButton.displayName;const G=e.forwardRef(({className:e,...t},r)=>u(v.ScrollDownButton,{ref:r,className:$("flex justify-center items-center py-1 cursor-default",e),...t,children:u(d,{icon:"chevron-down"})}));G.displayName=v.ScrollDownButton.displayName;const z=e.forwardRef(({className:e,children:t,position:r="popper",...a},n)=>u(v.Portal,{children:c(v.Content,{ref:n,className:$("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-sm border bg-white text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...a,children:[u(F,{}),u(v.Viewport,{className:$("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),u(G,{})]})}));z.displayName=v.Content.displayName;e.forwardRef(({className:e,...t},r)=>u(v.Label,{ref:r,className:$("px-2 py-1.5 text-sm font-semibold opacity-70",e),...t})).displayName=v.Label.displayName;const U=e.forwardRef(({className:e,children:t,...r},a)=>c(v.Item,{ref:a,className:$("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-slate-100 focus:text-primary-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[u("span",{className:"flex absolute right-2 justify-center items-center w-3.5 h-3.5",children:u(v.ItemIndicator,{children:u(d,{icon:"check",className:"w-4 h-4"})})}),u(v.ItemText,{children:t})]}));U.displayName=v.Item.displayName;e.forwardRef(({className:e,...t},r)=>u(v.Separator,{ref:r,className:$("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=v.Separator.displayName;const V=e.forwardRef(({className:e,thumbStyle:t,...r},a)=>u(b.Root,{className:$("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary-600 data-[state=unchecked]:bg-gray-400",e),...r,ref:a,children:u(b.Thumb,{className:$("pointer-events-none block h-5 w-5 rounded-full bg-primary-300 shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0",t)})}));V.displayName=b.Root.displayName;const W=({icon:e,children:t,tooltipText:r,side:a="top",className:n})=>c(w.Root,{delayDuration:0,children:[u(w.Trigger,{asChild:!0,children:c("span",{children:[e&&u(d,{icon:e,className:n}),t]})}),c(w.Content,{side:a,className:"bg-black text-white text-xs rounded px-2 py-1 shadow-md",children:[r,u(w.Arrow,{className:"fill-black"})]})]}),Y=w.Provider,H=N,B=e.forwardRef((e,t)=>{const{className:r,...a}=e;return u(N.List,{ref:t,className:$("max-h-[340px] overflow-y-auto overflow-x-hidden scroll-smooth scroll-padding",r),...a})});B.displayName=N.List.displayName;const P=e.forwardRef((e,t)=>{const{className:r,...a}=e;return u(N.Input,{ref:t,className:$("flex h-10 w-full border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50",r),...a})});P.displayName=N.Input.displayName;const E=e.forwardRef((e,t)=>{const{className:r,...a}=e;return u(N.Item,{ref:t,className:$("relative flex cursor-default select-none items-center px-2 py-1.5 text-sm outline-none transition-colors duration-200 ",r),...a})});E.displayName=N.Item.displayName;const J=e.forwardRef((e,t)=>{const{className:r,...a}=e;return u(N.Group,{ref:t,className:$("overflow-hidden text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-0 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",r),...a})});J.displayName=N.Group.displayName;e.forwardRef((e,t)=>{const{className:r,...a}=e;return u(N.Separator,{ref:t,className:$("-mx-1 h-px bg-border",r),...a})}).displayName=N.Separator.displayName;e.forwardRef(({className:e,...t},r)=>u(N.Dialog,{ref:r,className:$("fixed inset-0 z-50 flex items-start justify-center p-4 pt-[25vh] backdrop-blur-md",e),...t,children:u("div",{className:"w-full max-w-md rounded-md bg-background shadow-lg",children:t.children})})).displayName=N.Dialog.displayName;const Z=e.forwardRef(({className:e,...t},r)=>u("div",{ref:r,className:$("flex items-center justify-center p-4 text-sm text-muted-foreground",e),...t,children:"No results found."}));function q({className:e,classNames:t,showOutsideDays:r=!0,...a}){return u(C,{showOutsideDays:r,className:$("p-3",e),classNames:{months:"flex flex-col lg:flex-row space-y-16 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-xs font-medium",nav:"space-x-1 flex items-center",nav_button:$(M({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-200"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-0",cell:"h-8 w-8 text-center text-sm p-2 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:$(M({variant:"ghost"}),"h-8 w-8 hover:bg-primary-100 p-1 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary-600 text-white hover:bg-primary-600 hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...e})=>u(d,{icon:"chevron-left",className:"w-4 h-4"}),IconRight:({...e})=>u(d,{icon:"chevron-right",className:"w-4 h-4"})},...a})}Z.displayName="CommandEmpty",q.displayName="Calendar";var Q=1e3,K=6e4,X=36e5,ee="millisecond",te="second",re="minute",ae="hour",ne="day",se="week",oe="month",ie="quarter",le="year",de="date",ce="Invalid Date",ue=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,me=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,pe={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||t[0])+"]"}},fe=function(e,t,r){var a=String(e);return!a||a.length>=t?e:""+Array(t+1-a.length).join(r)+e},he={s:fe,z:function(e){var t=-e.utcOffset(),r=Math.abs(t),a=Math.floor(r/60),n=r%60;return(t<=0?"+":"-")+fe(a,2,"0")+":"+fe(n,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var a=12*(r.year()-t.year())+(r.month()-t.month()),n=t.clone().add(a,oe),s=r-n<0,o=t.clone().add(a+(s?-1:1),oe);return+(-(a+(r-n)/(s?n-o:o-n))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:oe,y:le,w:se,d:ne,D:de,h:ae,m:re,s:te,ms:ee,Q:ie}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},ye="en",ge={};ge[ye]=pe;var xe="$isDayjsObject",ve=function(e){return e instanceof Ce||!(!e||!e[xe])},be=function e(t,r,a){var n;if(!t)return ye;if("string"==typeof t){var s=t.toLowerCase();ge[s]&&(n=s),r&&(ge[s]=r,n=s);var o=t.split("-");if(!n&&o.length>1)return e(o[0])}else{var i=t.name;ge[i]=t,n=i}return!a&&n&&(ye=n),n||!a&&ye},we=function(e,t){if(ve(e))return e.clone();var r="object"==typeof t?t:{};return r.date=e,r.args=arguments,new Ce(r)},Ne=he;Ne.l=be,Ne.i=ve,Ne.w=function(e,t){return we(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var Ce=function(){function e(e){this.$L=be(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[xe]=!0}var t=e.prototype;return t.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(Ne.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var a=t.match(ue);if(a){var n=a[2]-1||0,s=(a[7]||"0").substring(0,3);return r?new Date(Date.UTC(a[1],n,a[3]||1,a[4]||0,a[5]||0,a[6]||0,s)):new Date(a[1],n,a[3]||1,a[4]||0,a[5]||0,a[6]||0,s)}}return new Date(t)}(e),this.init()},t.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},t.$utils=function(){return Ne},t.isValid=function(){return!(this.$d.toString()===ce)},t.isSame=function(e,t){var r=we(e);return this.startOf(t)<=r&&r<=this.endOf(t)},t.isAfter=function(e,t){return we(e)<this.startOf(t)},t.isBefore=function(e,t){return this.endOf(t)<we(e)},t.$g=function(e,t,r){return Ne.u(e)?this[t]:this.set(r,e)},t.unix=function(){return Math.floor(this.valueOf()/1e3)},t.valueOf=function(){return this.$d.getTime()},t.startOf=function(e,t){var r=this,a=!!Ne.u(t)||t,n=Ne.p(e),s=function(e,t){var n=Ne.w(r.$u?Date.UTC(r.$y,t,e):new Date(r.$y,t,e),r);return a?n:n.endOf(ne)},o=function(e,t){return Ne.w(r.toDate()[e].apply(r.toDate("s"),(a?[0,0,0,0]:[23,59,59,999]).slice(t)),r)},i=this.$W,l=this.$M,d=this.$D,c="set"+(this.$u?"UTC":"");switch(n){case le:return a?s(1,0):s(31,11);case oe:return a?s(1,l):s(0,l+1);case se:var u=this.$locale().weekStart||0,m=(i<u?i+7:i)-u;return s(a?d-m:d+(6-m),l);case ne:case de:return o(c+"Hours",0);case ae:return o(c+"Minutes",1);case re:return o(c+"Seconds",2);case te:return o(c+"Milliseconds",3);default:return this.clone()}},t.endOf=function(e){return this.startOf(e,!1)},t.$set=function(e,t){var r,a=Ne.p(e),n="set"+(this.$u?"UTC":""),s=(r={},r[ne]=n+"Date",r[de]=n+"Date",r[oe]=n+"Month",r[le]=n+"FullYear",r[ae]=n+"Hours",r[re]=n+"Minutes",r[te]=n+"Seconds",r[ee]=n+"Milliseconds",r)[a],o=a===ne?this.$D+(t-this.$W):t;if(a===oe||a===le){var i=this.clone().set(de,1);i.$d[s](o),i.init(),this.$d=i.set(de,Math.min(this.$D,i.daysInMonth())).$d}else s&&this.$d[s](o);return this.init(),this},t.set=function(e,t){return this.clone().$set(e,t)},t.get=function(e){return this[Ne.p(e)]()},t.add=function(e,t){var r,a=this;e=Number(e);var n=Ne.p(t),s=function(t){var r=we(a);return Ne.w(r.date(r.date()+Math.round(t*e)),a)};if(n===oe)return this.set(oe,this.$M+e);if(n===le)return this.set(le,this.$y+e);if(n===ne)return s(1);if(n===se)return s(7);var o=(r={},r[re]=K,r[ae]=X,r[te]=Q,r)[n]||1,i=this.$d.getTime()+e*o;return Ne.w(i,this)},t.subtract=function(e,t){return this.add(-1*e,t)},t.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||ce;var a=e||"YYYY-MM-DDTHH:mm:ssZ",n=Ne.z(this),s=this.$H,o=this.$m,i=this.$M,l=r.weekdays,d=r.months,c=r.meridiem,u=function(e,r,n,s){return e&&(e[r]||e(t,a))||n[r].slice(0,s)},m=function(e){return Ne.s(s%12||12,e,"0")},p=c||function(e,t,r){var a=e<12?"AM":"PM";return r?a.toLowerCase():a};return a.replace(me,function(e,a){return a||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return Ne.s(t.$y,4,"0");case"M":return i+1;case"MM":return Ne.s(i+1,2,"0");case"MMM":return u(r.monthsShort,i,d,3);case"MMMM":return u(d,i);case"D":return t.$D;case"DD":return Ne.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(r.weekdaysMin,t.$W,l,2);case"ddd":return u(r.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(s);case"HH":return Ne.s(s,2,"0");case"h":return m(1);case"hh":return m(2);case"a":return p(s,o,!0);case"A":return p(s,o,!1);case"m":return String(o);case"mm":return Ne.s(o,2,"0");case"s":return String(t.$s);case"ss":return Ne.s(t.$s,2,"0");case"SSS":return Ne.s(t.$ms,3,"0");case"Z":return n}return null}(e)||n.replace(":","")})},t.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},t.diff=function(e,t,r){var a,n=this,s=Ne.p(t),o=we(e),i=(o.utcOffset()-this.utcOffset())*K,l=this-o,d=function(){return Ne.m(n,o)};switch(s){case le:a=d()/12;break;case oe:a=d();break;case ie:a=d()/3;break;case se:a=(l-i)/6048e5;break;case ne:a=(l-i)/864e5;break;case ae:a=l/X;break;case re:a=l/K;break;case te:a=l/Q;break;default:a=l}return r?a:Ne.a(a)},t.daysInMonth=function(){return this.endOf(oe).$D},t.$locale=function(){return ge[this.$L]},t.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),a=be(e,t,!0);return a&&(r.$L=a),r},t.clone=function(){return Ne.w(this.$d,this)},t.toDate=function(){return new Date(this.valueOf())},t.toJSON=function(){return this.isValid()?this.toISOString():null},t.toISOString=function(){return this.$d.toISOString()},t.toString=function(){return this.$d.toUTCString()},e}(),ke=Ce.prototype;we.prototype=ke,[["$ms",ee],["$s",te],["$m",re],["$H",ae],["$W",ne],["$M",oe],["$y",le],["$D",de]].forEach(function(e){ke[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),we.extend=function(e,t){return e.$i||(e(t,Ce,we),e.$i=!0),we},we.locale=be,we.isDayjs=ve,we.unix=function(e){return we(1e3*e)},we.en=ge[ye],we.Ls=ge,we.p={};const $e=(e,t)=>{switch(t){case"number":return Number(e);case"date":return we(e).isValid()?new Date(e):new Date;case"boolean":return Boolean(e);case"float":return parseFloat(e);default:return e}},Se={"<":(e,t)=>e<t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<=":(e,t)=>e<=t,"=":(e,t)=>Array.isArray(e)&&Array.isArray(t)?t.some(t=>e.includes(t)):Array.isArray(e)?e.includes(t):Array.isArray(t)?t.includes(e):e===t,"!=":(e,t)=>Array.isArray(e)&&Array.isArray(t)?!t.some(t=>e.includes(t)):Array.isArray(e)?!e.includes(t):Array.isArray(t)?!t.includes(e):e!==t,contains:(e,t)=>"string"==typeof e&&"string"==typeof t&&e.toLowerCase().includes(t.toLowerCase()),beginswith:(e,t)=>"string"==typeof e&&"string"==typeof t&&e.toLowerCase().startsWith(t.toLowerCase()),process(e,t,r){return this[r](e,t)}};function Ae(e,t){if(!t)return!0;if(t.operator&&Array.isArray(t.rules)&&1===t.rules.length)return Ae(e,t.rules[0]);if(Array.isArray(t))return t.every(t=>Ae(e,t));if(t.operator&&Array.isArray(t.rules)){const r=t.operator.toLowerCase();if("and"===r)return t.rules.every(t=>Ae(e,t));if("or"===r)return t.rules.some(t=>Ae(e,t))}if(t.key&&t.operator&&void 0!==t.value){const{key:r,value:a,operator:n}=t;let s=e[r];if(null==s)return("!="===n||"not_equals"===n)&&(null!=a&&""!==a);try{return Se.process(s,a,n)}catch(e){return console.warn("Filter evaluation error:",e,{key:r,value:a,operator:n,itemValue:s}),!1}}return!0}function Me(e,t){if(!e)return e;return Array.isArray(e)?e.map(e=>Me(e,t)):e.operator&&Array.isArray(e.rules)?{...e,rules:e.rules.map(e=>Me(e,t))}:e.and?{...e,and:e.and.map(e=>Me(e,t))}:e.or?{...e,or:e.or.map(e=>Me(e,t))}:e.key&&((r=e.key)&&null!=t&&null!==(a=t.all)&&void 0!==a&&a.map&&"date"===(null===(n=t.all.map[r])||void 0===n?void 0:n.type))&&"string"==typeof e.value?{...e,value:new Date(e.value)}:e;var r,a,n}const De=(e,t,r,a)=>{if(!t)return Array.isArray(e)?[...e]:[];const n=Me(t,a);return e.filter(e=>Ae(r&&r[e.id]?r[e.id]:e,n))};function _e(e){return e?Array.isArray(e)?e.reduce((e,t)=>e+_e(t),0):e.rules&&Array.isArray(e.rules)?_e(e.rules):e.key?1:0:0}function Oe({placeholder:e="Enter a date",value:t,onChange:r,format:a="yyyy MMM dd",calendarClassName:n,className:s}){const o=t instanceof Date&&!isNaN(t)?k(t,a):"";return c(O,{children:[u(R,{asChild:!0,children:u(D,{variant:"outline",className:$("text-xs border-0 border-b-[1px] shadow-none p-1 justify-start text-left font-normal",!t&&"text-slate-500",s),children:o||u("span",{children:e})})}),u(L,{className:"p-0 w-auto",align:"start",children:u(q,{className:$("bg-gray-100",n),classNames:{head_cell:"h-8 w-8 text-sm font-medium",cell:"h-8 w-8 text-slate-600"},mode:"single",selected:t instanceof Date&&!isNaN(t)?t:void 0,onSelect:e=>r(e),initialFocus:!0})})]})}const Re=e=>"object"==typeof e?e.path:e,Le=({selected:e,onRemove:t,onClearAll:r})=>{const a=e.slice().sort((e,t)=>{const r="object"==typeof e?e.label:e,a="object"==typeof t?t.label:t;return r.localeCompare(a)});return c("div",{className:"relative flex items-center justify-between px-4 pt-2 pb-4 gap-2 border-b pr-8",children:[u("div",{className:"flex flex-wrap gap-2",children:a.map(e=>c("span",{onClick:r=>{r.stopPropagation(),t(e)},className:"flex items-center bg-primary-400/10 text-[10px] px-1 py-0.5 rounded-sm cursor-pointer hover:bg-gray-200 transition",children:["object"==typeof e?e.label:e,u(d,{icon:"close",className:"h-2 w-2 ml-1 text-primary-600"})]},Re(e)))}),u("div",{onClick:e=>{e.stopPropagation(),r()},className:"absolute top-1 right-2 cursor-pointer",children:u(W,{tooltipText:"Clear all",icon:"close",className:"h-4 w-4 mr-1 text-gray-500 hover:text-gray-800 transition"})})]})},Te=({options:e,selected:t,onOptionSelect:r,className:a,multiple:n,isSmall:s,optionTooltip:o})=>{const i=e.slice().sort((e,t)=>{var r,a;const n=(null===(r=e.label)||void 0===r?void 0:r.toLowerCase())??"",s=(null===(a=t.label)||void 0===a?void 0:a.toLowerCase())??"";return n.localeCompare(s)});return u("div",{className:$(a),children:i.map((e,a)=>{if(e.isLoading)return u(E,{value:e.label,className:"px-4 py-2 text-sm text-gray-500 cursor-default",disabled:!0,children:c("div",{className:"flex items-center gap-2",children:[u(S,{className:"w-4 h-4"}),u("span",{children:e.label})]})},"loading-state");const i=n||s?t.some(t=>Re(t)===Re(e)):t&&Re(t)===Re(e);if(e.options)return u(J,{className:"px-2 mt-2 overflow-visible",heading:u("span",{className:"cursor-default font-bold text-sm text-gray-800 whitespace-nowrap",children:e.label}),children:u(Te,{options:e.options,selected:t,onOptionSelect:r,multiple:n,isSmall:s,optionTooltip:o})},a);{const t=u(E,{value:e.label,className:$("px-4 cursor-pointer hover:bg-gray-100 font-light border-b border-gray-100 whitespace-nowrap",i&&"bg-primary-400/10"),onSelect:()=>r(e),children:c("div",{className:"flex justify-between items-center w-full gap-2",children:[u("span",{className:"whitespace-nowrap",children:e.label}),i&&u(d,{icon:"check",className:"text-primary-600 h-3 w-3 ml-2 flex-shrink-0"})]})},a);if(o){const r="function"==typeof o?o(e):null==o?void 0:o[e.path];return r?u(W,{tooltipText:r,side:"right",children:t},a):t}return t}})})},Ie=({options:e,selected:t=[],onSelect:a,trigger:n,children:s,className:o,multiple:i=!1,isSearchable:l=!0,isSmall:d=!1,isShadow:m=!0,showSelectedSummary:p=!0,onSearchChange:f,searchPlaceholder:h="Search...",shouldFilter:y=!0,optionTooltip:g,searchFields:x=["label"]})=>{const[v,b]=r(!1),[w,N]=r(""),C=y?((e,t)=>{if(!t)return e;const r=t.toLowerCase(),a=(e=>{const t=[],r=e=>{e.forEach(e=>{e.options?r(e.options):e.isLoading||t.push(e)})};return r(e),t})(e).filter(e=>x.some(t=>{var a;return null===(a=e[t])||void 0===a?void 0:a.toLowerCase().includes(r)})),n=new Set(a.map(e=>e.path)),s=e=>e.map(e=>{if(e.options){const r=((e,t)=>e.toLowerCase().includes(t.toLowerCase()))(e.label,t);if(r)return{...e,matchedGroup:!0};const a=s(e.options);return a.length>0?{...e,options:a,matchedGroup:!1}:null}return e.isLoading||n.has(e.path)?e:null}).filter(Boolean);return s(e)})(e,w):e,k=e=>{if(i){const r=t.some(t=>Re(t)===Re(e))?t.filter(t=>Re(t)!==Re(e)):[...t,e];a(r)}else a(e),b(!1)};return u("div",{className:$("relative flex",o),children:c(O,{open:v,onOpenChange:b,children:[u(R,{asChild:!0,className:"flex items-center gap-1 text-gray-500 text-sm "+(d?"border-none px-1 text-xs py-0":"border-b px-2 py-1"),children:s||n(t)}),u(L,{align:"start",sideOffset:4,className:$("bg-white border w-auto",!m&&"shadow-none"),children:u(Y,{children:c(H,{shouldFilter:!1,children:[l&&u(P,{placeholder:h,className:"px-4 py-2 mb-2 border-b border-gray-300",onValueChange:e=>{N(e),f&&f(e)}}),c(B,{children:[i&&t.length>0&&("always"===p||!1!==p&&e.length>6)&&u(Le,{selected:t,onRemove:k,onClearAll:()=>a([])}),u(Te,{options:C,selected:t,onOptionSelect:k,multiple:i,isSmall:d,optionTooltip:g}),0===C.length&&u(Z,{})]})]})})})]})})},je={number:["<",">","<=",">="],string:["contains","beginswith"],date:["<",">","<=",">="],boolean:[],select:[],__all__:["=","!="]},Fe={number:"number",string:"text",date:"date"},Ge=({removeFilter:e,filter:t,keys:r,types:n,handleFilterChange:s,options:o,keysMeta:i})=>{var l;const{key:m,id:p,operator:f,value:h}=t,y=a(()=>m&&n[m],[m,n]),g=a(()=>y?[...je.__all__,...je[y]]:je.__all__,[y]),x=a(()=>Fe[y]||"text",[y]),v=a(()=>{var e;return"select"===y&&null!=o&&null!==(e=o[m])&&void 0!==e&&e.length?o[m]:[]},[y,o,m]),b=(e,t)=>{let r;r="key"===e?{[e]:t,operator:"=",value:$e("",n[t])}:{[e]:t},s(p,r)};return c("div",{className:"flex gap-2 items-center w-full",children:[c("div",{className:"flex gap-4 items-center w-full",children:[u("div",{className:"flex-shrink-0 w-[200px]",children:u(Ie,{selected:m,onSelect:e=>b("key",e.path),options:r,children:c("button",{className:"border-b-[1px] pl-2 text-sm focus:ring-0 flex items-center w-full h-9",children:[u(d,{icon:"sort",className:"h-3 w-3"}),u("span",{className:"truncate",children:null===(l=i[m])||void 0===l?void 0:l.label})]})})}),u("div",{className:"flex-shrink-0 w-[75px]",children:c(T,{onValueChange:e=>b("operator",e),value:f,children:[u(j,{iconClassName:"h-3 w-3 text-gray-500",className:"border-0 border-b-[1px] shadow-none focus:ring-0 text-sm pl-0 text-gray-600 w-full",children:u(I,{className:"text-slate-700 truncate",placeholder:"Select"})}),u(z,{className:"text-slate-700",children:g.map(e=>u(U,{value:e,children:e},e))})]})}),c("div",{className:"flex-1",children:["select"===y&&u(Ie,{options:v,selected:i[m].multiple?Array.isArray(h)?h.map(e=>v.find(t=>t.path===e)||e):[]:v.find(e=>e.path===h)||h,onSelect:e=>{const t=Array.isArray(e)?e.map(e=>e.path??e):e.path??e;b("value",t)},multiple:i[m].multiple??!1,isSearchable:!0,isSmall:!1,showSelectedSummary:!1,trigger:e=>{var t;return((e,t,r,a,n,s)=>u(A,{selected:e,leftIcon:t,rightIcon:r,className:a,iconClassName:n,placeholder:s,maxWidth:"flex-1"}))(e,"sort",null,"border-b-[1px] pl-2 text-sm focus:ring-0 flex items-center w-full h-9","mr-2",i[m].multiple?"Select":(null===(t=v.find(e=>e.path===h))||void 0===t?void 0:t.label)||"Select")}}),"date"===y&&u(Oe,{placeholder:"Enter a date",value:h,format:"yyyy MMM dd",onChange:e=>b("value",e),className:"w-full text-sm",calendarClassName:"border-t-2 border-primary-600"},"date"),"boolean"===y&&u("div",{className:"flex justify-center items-center h-full text-center",children:u(W,{tooltipText:"Toggle to enable or disable",className:"mr-2 text-gray-500",children:u(V,{onCheckedChange:e=>b("value",!!e),checked:!!h,className:"w-10 h-4.5 rounded-full border-transparent transition-colors data-[state=checked]:bg-primary-700 data-[state=unchecked]:bg-gray-500",thumbStyle:"w-4 h-4 bg-white rounded-full shadow-md transform transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"})})}),("string"===y||"number"===y)&&u(_,{defaultValue:h,placeholder:"Enter a value",onBlur:e=>{var t;return b("value",$e(null==e||null===(t=e.target)||void 0===t?void 0:t.value,y))},type:x,className:"pl-2 bg-transparent text-sm rounded-none border-t-0 border-r-0 border-b-[1px] border-l-0 focus:ring-2 focus:ring-primary-500 focus:border-transparent h-9 w-full"})]})]}),u(W,{tooltipText:"Remove item",children:u("div",{onClick:()=>e(p),className:"cursor-pointer",children:u(d,{icon:"multiply"})})})]})},ze=()=>{var e;return null===(e=crypto)||void 0===e?void 0:e.randomUUID()},Ue=(e={},t)=>({id:ze(),...t,...e,isGroup:!1}),Ve=(e=[],t="and")=>({id:ze(),isGroup:!0,operator:t.toLowerCase(),rules:e}),We=({onAddCondition:e,onAddGroup:t,canAddGroup:r=!0,level:a=0})=>{const n=a>=2,s="text-gray-600 font-medium cursor-pointer hover:text-primary-600 text-sm";return c("div",{className:"flex gap-4",children:[u("span",{className:s,onClick:e,children:"+ Add condition"}),r&&(n?u(W,{tooltipText:"Filter condition can only be nested three level deep",children:u("span",{className:"text-gray-400 text-sm cursor-not-allowed",children:"+ Add condition group"})}):u("span",{className:s,onClick:t,children:"+ Add condition group"}))]})},Ye=({value:e,onChange:t})=>c(T,{defaultValue:e.toUpperCase(),onValueChange:e=>t(e.toLowerCase()),children:[u(j,{iconClassName:"h-3 w-3 text-gray-500",className:"border-0 border-b-[1px] shadow-none focus:ring-0 text-sm pl-0 text-gray-600 w-[55px]",children:u(I,{})}),c(z,{children:[u(U,{value:"AND",children:"and"}),u(U,{value:"OR",children:"or"})]})]}),He=({group:e,onChange:t,onRemove:r,keys:a,types:n,options:s,defaultCondition:o,keysMeta:i,level:l=0,isRoot:m=!1})=>{const p=e.rules||[],f=e.operator||e.logic||"and",h=(r,a)=>{const n=p.map(e=>e.id===r?a:e);t({...e,rules:n})},y=r=>{const a=p.filter(e=>e.id!==r);t({...e,rules:a})},g=r=>{t({...e,rules:[...p,r]})},x=r=>{t({...e,operator:r.toLowerCase()})},v=!m,b=!m,w=0===p.length;return c("div",{className:$("flex flex-col gap-4",v&&"rounded-sm py-2 px-4 border bg-gray-100"),children:[w&&b&&u("div",{className:"text-sm font-light",children:"Add conditions or sub-groups."}),p.map((e,t)=>c("div",{className:"flex gap-2 items-start",children:[0===t?u("span",{className:"w-[55px] pt-2 text-sm font-medium text-gray-700",children:"Where"}):1===t?u(Ye,{value:f,onChange:x}):u("span",{className:"w-[55px] pt-2 text-sm text-gray-700",children:f}),u("div",{className:"flex-1",children:e.isGroup?u(He,{group:e,onChange:t=>h(e.id,t),onRemove:()=>y(e.id),keys:a,types:n,options:s,defaultCondition:o,keysMeta:i,level:l+1,isRoot:!1}):u(Ge,{filter:e,handleFilterChange:(t,r)=>h(e.id,{...e,...r}),removeFilter:()=>y(e.id),types:n,keys:a,options:s,keysMeta:i})})]},e.id)),b&&c("div",{className:"flex justify-between gap-10 items-center pt-2 border-t border-gray-200",children:[u(We,{onAddCondition:()=>g(Ue({},o)),onAddGroup:()=>g(Ve()),level:l}),u(W,{tooltipText:"Remove group",children:u("button",{onClick:r,className:"text-gray-600 hover:text-gray-900 transition-colors",children:u(d,{icon:"multiply"})})})]})]})},Be=({onAddCondition:e,onAddGroup:t})=>c("div",{className:"flex gap-6",children:[u("span",{className:"text-gray-600 font-medium cursor-pointer hover:text-primary-600 text-sm",onClick:e,children:"+ Add condition"}),u("span",{className:"text-gray-600 font-medium cursor-pointer hover:text-primary-600 text-sm",onClick:t,children:"+ Add condition group"})]}),Pe=e=>{if(!e)return null;if(!e.isGroup){const{id:t,isGroup:r,...a}=e;return a.key&&a.operator?a:null}const t=(e.rules||[]).map(e=>Pe(e)).filter(Boolean);return 0===t.length?null:{operator:e.operator||"and",rules:t}},Ee=e=>{return e&&e.operator&&Array.isArray(e.rules)?{id:null===(t=crypto)||void 0===t?void 0:t.randomUUID(),isGroup:!0,operator:e.operator,rules:e.rules.map(e=>{return e.operator&&e.rules?Ee(e):{id:null===(t=crypto)||void 0===t?void 0:t.randomUUID(),isGroup:!1,...e};var t})}:null;var t},Je=({keys:e,types:t,initialFilters:a,updateFilters:s,options:o,defaultCondition:i,keysMeta:l,closePopover:p})=>{const[f,h]=r(()=>a?a.isGroup?a:Ee(a):null),y=((null==f?void 0:f.rules)||[]).length>0,g=Boolean(f&&y),x=e=>{if(!f)return;const t=f.rules||[];h({...f,rules:[...t,e]})};return n(()=>{if(a){const e=a.isGroup?a:Ee(a);h(e)}},[a]),c("div",{className:"text-slate-600 w-full",children:[c("div",{className:"flex items-center gap-2 mb-4",children:[u(d,{icon:"filter",className:"text-primary-700",size:"lg"}),u("h2",{className:"text-lg font-medium text-gray-800",children:"Filter"})]}),f?c(m,{children:[g&&u("div",{className:"flex gap-2 items-start mb-4",children:u("div",{className:"flex-1",children:u(He,{group:f,onChange:h,onRemove:()=>h(null),keys:e,types:t,options:o,defaultCondition:i,keysMeta:l,level:0,isRoot:!0})})}),c("div",{className:"flex justify-between items-center gap-10",children:[u(Be,{onAddCondition:()=>x(Ue({},i)),onAddGroup:()=>x(Ve())}),c(D,{className:"rounded-sm shadow-sm text-xs transition-all hover:shadow-md",onClick:()=>{const e=Pe(f);s(e),p()},children:[u(d,{icon:"filter",className:"mr-1",size:"sm"}),u("span",{children:"Apply"})]})]})]}):u(Be,{onAddCondition:()=>{h(Ve([Ue({},i)]))},onAddGroup:()=>{const e=Ve();h(Ve([e]))}})]})};function Ze({className:e,closePopover:t,options:r,filterData:a,defaultCondition:n,filters:s,updateFilters:o,keysMeta:i}){return u("div",{className:$(e),children:u(Je,{keys:(null==a?void 0:a.fields)||[],types:(null==a?void 0:a.types)||{},initialFilters:s,updateFilters:o,options:r,defaultCondition:n,keysMeta:i,closePopover:t})})}function qe({options:e,filterData:t,defaultCondition:a,filters:n,updateFilters:s,keysMeta:o}){const[i,l]=r(!1),m=_e(n);return c(O,{className:"z-10",style:{zIndex:10},open:i,onOpenChange:()=>l(!i),children:[u(R,{asChild:!0,children:c(D,{className:"rounded-sm h-10 w-10 text-lg shadow-lg relative",children:[u(d,{icon:"filter"}),m>0&&u("span",{className:"absolute top-0 right-0 text-xs bg-primary-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-center -mr-2 -mt-2",children:m})]})}),u(L,{className:"max-w-[60vw] w-auto max-h-[70vh] overflow-y-auto rounded-none bg-gray-50 border-t-2 border-t-primary-700 p-6",children:u(Y,{children:u(Ze,{closePopover:()=>l(!1),options:e,filterData:t,defaultCondition:a,filters:n,updateFilters:s,keysMeta:o})})})]})}export{qe as FilterPopover,De as applyFilterFn};
//# sourceMappingURL=index.esm.js.map
