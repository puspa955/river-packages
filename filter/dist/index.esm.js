import*as e from"react";import{forwardRef as t,useState as r,useMemo as a,useEffect as l}from"react";import{Slot as o}from"@radix-ui/react-slot";import{cva as s}from"class-variance-authority";import{clsx as n}from"clsx";import{twMerge as i}from"tailwind-merge";import{FontAwesomeIcon as d}from"@fortawesome/react-fontawesome";import{jsxs as c,jsx as m,Fragment as u}from"react/jsx-runtime";import*as p from"@radix-ui/react-popover";import{config as f,library as h}from"@fortawesome/fontawesome-svg-core";import{faCheck as y,faXmark as g,faFilter as x}from"@fortawesome/free-solid-svg-icons";import*as b from"@radix-ui/react-select";import*as v from"@radix-ui/react-switch";import*as N from"@radix-ui/react-tooltip";import{Command as w}from"cmdk";import{DayPicker as C}from"react-day-picker";import k from"dayjs/esm";import{format as A}from"date-fns";function S(...e){return i(n(e))}const _=({className:e})=>m(d,{icon:"spinner",className:S("animate-spin text-primary-600",e)}),R=t(({selected:e,leftIcon:t,rightIcon:r,className:a,iconClassName:l,placeholder:o,maxWidth:s="max-w-20",...n},i)=>c("button",{ref:i,className:S("flex items-center border-b pb-1 px-2 text-gray-500 text-sm font-light cursor-pointer min-w-0 overflow-hidden",a),...n,children:[c("div",{className:"flex text-start items-center justify-center truncate min-w-0",children:[t&&m(d,{icon:t,className:S("h-3 w-3 text-secondary-500 flex-shrink-0",l)}),m("span",{className:`truncate min-w-0 ${s} ${t?"pl-1":""}`,children:e&&e.length?Array.isArray(e)?`${e.length} selected`:e.label:o})]}),r&&m(d,{icon:r,className:"h-3 w-3 pl-1 flex-shrink-0"})]}));R.displayName="SelectTrigger";const F=s("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary-700 text-primary-50 shadow hover:bg-primary-800",danger:"bg-red-700 text-red-50 shadow-sm hover:bg-red-800",outline:"border border-input shadow-sm hover:bg-gray-100",secondary:"bg-secondary-700 text-secondary-50 shadow-sm hover:bg-secondary-800",ghost:"hover:bg-primary-50",link:"text-primary-800 underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),M=t(({className:e,variant:t,size:r,asChild:a=!1,loading:l=!1,children:s,...n},i)=>{const d=a?o:"button",p=a?c("span",{className:"inline-flex items-center",children:[l&&m(_,{className:"mr-2 h-4 w-4 animate-spin text-current"}),s]}):c(u,{children:[l&&m(_,{className:"mr-2 h-4 w-4 animate-spin text-current"}),s]});return m(d,{className:S(F({variant:t,size:r,className:e})),title:n.title,ref:i,disabled:n.disabled||l,...n,children:p})});M.displayName="Button";const D=e.forwardRef(({className:e,type:t,...r},a)=>m("input",{type:t,className:S("flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-0 disabled:cursor-not-allowed disabled:opacity-50",e),ref:a,...r}));D.displayName="Input";const I=p.Root,L=p.Trigger,j=e.forwardRef(({className:e,align:t="center",sideOffset:r=4,...a},l)=>m(p.Portal,{children:m(p.Content,{ref:l,align:t,sideOffset:r,className:S("bg-popover text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...a})}));j.displayName=p.Content.displayName,f.autoAddCss=!1,h.add(y,g,x);const G=b.Root,T=b.Value,z=e.forwardRef(({iconClassName:e,className:t,isIconShow:r=!0,children:a,...l},o)=>c(b.Trigger,{ref:o,className:S("flex h-9 w-full items-center whitespace-nowrap rounded-sm border bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...l,children:[m(b.Icon,{asChild:!0,children:r&&m(d,{icon:"sort",className:S("mr-2 w-4 h-4",e)})}),a]}));z.displayName=b.Trigger.displayName;const P=e.forwardRef(({className:e,...t},r)=>m(b.ScrollUpButton,{ref:r,className:S("flex justify-center items-center py-1 cursor-default",e),...t,children:m(d,{icon:"chevron-up"})}));P.displayName=b.ScrollUpButton.displayName;const O=e.forwardRef(({className:e,...t},r)=>m(b.ScrollDownButton,{ref:r,className:S("flex justify-center items-center py-1 cursor-default",e),...t,children:m(d,{icon:"chevron-down"})}));O.displayName=b.ScrollDownButton.displayName;const B=e.forwardRef(({className:e,children:t,position:r="popper",...a},l)=>m(b.Portal,{children:c(b.Content,{ref:l,className:S("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-sm border bg-white text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===r&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:r,...a,children:[m(P,{}),m(b.Viewport,{className:S("p-1","popper"===r&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),m(O,{})]})}));B.displayName=b.Content.displayName;e.forwardRef(({className:e,...t},r)=>m(b.Label,{ref:r,className:S("px-2 py-1.5 text-sm font-semibold opacity-70",e),...t})).displayName=b.Label.displayName;const V=e.forwardRef(({className:e,children:t,...r},a)=>c(b.Item,{ref:a,className:S("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-slate-100 focus:text-primary-900 data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...r,children:[m("span",{className:"flex absolute right-2 justify-center items-center w-3.5 h-3.5",children:m(b.ItemIndicator,{children:m(d,{icon:"check",className:"w-4 h-4"})})}),m(b.ItemText,{children:t})]}));V.displayName=b.Item.displayName;e.forwardRef(({className:e,...t},r)=>m(b.Separator,{ref:r,className:S("-mx-1 my-1 h-px bg-muted",e),...t})).displayName=b.Separator.displayName;const U=e.forwardRef(({className:e,thumbStyle:t,...r},a)=>m(v.Root,{className:S("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary-600 data-[state=unchecked]:bg-gray-400",e),...r,ref:a,children:m(v.Thumb,{className:S("pointer-events-none block h-5 w-5 rounded-full bg-primary-300 shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0",t)})}));U.displayName=v.Root.displayName;const E=({icon:e,children:t,tooltipText:r,side:a="top",className:l})=>c(N.Root,{delayDuration:0,children:[m(N.Trigger,{asChild:!0,children:c("span",{children:[e&&m(d,{icon:e,className:l}),t]})}),c(N.Content,{side:a,className:"bg-black text-white text-xs rounded px-2 py-1 shadow-md",children:[r,m(N.Arrow,{className:"fill-black"})]})]}),W=N.Provider,$=w,q=e.forwardRef((e,t)=>{const{className:r,...a}=e;return m(w.List,{ref:t,className:S("max-h-[340px] overflow-y-auto overflow-x-hidden scroll-smooth scroll-padding",r),...a})});q.displayName=w.List.displayName;const H=e.forwardRef((e,t)=>{const{className:r,...a}=e;return m(w.Input,{ref:t,className:S("flex h-10 w-full border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-0 disabled:cursor-not-allowed disabled:opacity-50",r),...a})});H.displayName=w.Input.displayName;const J=e.forwardRef((e,t)=>{const{className:r,...a}=e;return m(w.Item,{ref:t,className:S("relative flex cursor-default select-none items-center px-2 py-1.5 text-sm outline-none transition-colors duration-200 ",r),...a})});J.displayName=w.Item.displayName;const K=e.forwardRef((e,t)=>{const{className:r,...a}=e;return m(w.Group,{ref:t,className:S("overflow-hidden text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-0 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",r),...a})});K.displayName=w.Group.displayName;e.forwardRef((e,t)=>{const{className:r,...a}=e;return m(w.Separator,{ref:t,className:S("-mx-1 h-px bg-border",r),...a})}).displayName=w.Separator.displayName;e.forwardRef(({className:e,...t},r)=>m(w.Dialog,{ref:r,className:S("fixed inset-0 z-50 flex items-start justify-center p-4 pt-[25vh] backdrop-blur-md",e),...t,children:m("div",{className:"w-full max-w-md rounded-md bg-background shadow-lg",children:t.children})})).displayName=w.Dialog.displayName;const Q=e.forwardRef(({className:e,...t},r)=>m("div",{ref:r,className:S("flex items-center justify-center p-4 text-sm text-muted-foreground",e),...t,children:"No results found."}));function X({className:e,classNames:t,showOutsideDays:r=!0,...a}){return m(C,{showOutsideDays:r,className:S("p-3",e),classNames:{months:"flex flex-col lg:flex-row space-y-16 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-xs font-medium",nav:"space-x-1 flex items-center",nav_button:S(F({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-200"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-0",cell:"h-8 w-8 text-center text-sm p-2 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:S(F({variant:"ghost"}),"h-8 w-8 hover:bg-primary-100 p-1 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary-600 text-white hover:bg-primary-600 hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...t},components:{IconLeft:({...e})=>m(d,{icon:"chevron-left",className:"w-4 h-4"}),IconRight:({...e})=>m(d,{icon:"chevron-right",className:"w-4 h-4"})},...a})}Q.displayName="CommandEmpty",X.displayName="Calendar";const Y=(e,t)=>{switch(t){case"number":return Number(e);case"date":return k(e).isValid()?new Date(e):new Date;case"boolean":return Boolean(e);case"float":return parseFloat(e);default:return e}},Z={"<":(e,t)=>e<t,">":(e,t)=>e>t,">=":(e,t)=>e>=t,"<=":(e,t)=>e<=t,"=":(e,t)=>Array.isArray(e)&&Array.isArray(t)?t.some(t=>e.includes(t)):Array.isArray(e)?e.includes(t):Array.isArray(t)?t.includes(e):e===t,"!=":(e,t)=>Array.isArray(e)&&Array.isArray(t)?!t.some(t=>e.includes(t)):Array.isArray(e)?!e.includes(t):Array.isArray(t)?!t.includes(e):e!==t,contains:(e,t)=>"string"==typeof e&&"string"==typeof t&&e.toLowerCase().includes(t.toLowerCase()),beginswith:(e,t)=>"string"==typeof e&&"string"==typeof t&&e.toLowerCase().startsWith(t.toLowerCase()),process(e,t,r){return this[r](e,t)}};function ee(e,t){if(!t)return!0;if(t.operator&&Array.isArray(t.rules)&&1===t.rules.length)return ee(e,t.rules[0]);if(Array.isArray(t))return t.every(t=>ee(e,t));if(t.operator&&Array.isArray(t.rules)){const r=t.operator.toLowerCase();if("and"===r)return t.rules.every(t=>ee(e,t));if("or"===r)return t.rules.some(t=>ee(e,t))}if(t.key&&t.operator&&void 0!==t.value){const{key:r,value:a,operator:l}=t;let o=e[r];if(null==o)return("!="===l||"not_equals"===l)&&(null!=a&&""!==a);try{return Z.process(o,a,l)}catch(e){return console.warn("Filter evaluation error:",e,{key:r,value:a,operator:l,itemValue:o}),!1}}return!0}function te(e,t){if(!e)return e;return Array.isArray(e)?e.map(e=>te(e,t)):e.operator&&Array.isArray(e.rules)?{...e,rules:e.rules.map(e=>te(e,t))}:e.and?{...e,and:e.and.map(e=>te(e,t))}:e.or?{...e,or:e.or.map(e=>te(e,t))}:e.key&&((r=e.key)&&null!=t&&null!==(a=t.all)&&void 0!==a&&a.map&&"date"===(null===(l=t.all.map[r])||void 0===l?void 0:l.type))&&"string"==typeof e.value?{...e,value:new Date(e.value)}:e;var r,a,l}const re=(e,t,r,a)=>{if(!t)return Array.isArray(e)?[...e]:[];const l=te(t,a);return e.filter(e=>ee(r&&r[e.id]?r[e.id]:e,l))};function ae(e){return e?Array.isArray(e)?e.reduce((e,t)=>e+ae(t),0):e.rules&&Array.isArray(e.rules)?ae(e.rules):e.key?1:0:0}function le({placeholder:e="Enter a date",value:t,onChange:r,format:a="yyyy MMM dd",calendarClassName:l,className:o}){const s=t?A(t,a):"";return c(I,{children:[m(L,{asChild:!0,children:m(M,{variant:"outline",className:S("text-xs border-0 border-b-[1px] shadow-none p-1 justify-start text-left font-normal",!t&&"text-slate-500",o),children:t?s:m("span",{children:e})})}),m(j,{className:"p-0 w-auto",align:"start",children:m(X,{className:S("bg-gray-100",l),classNames:{head_cell:"h-8 w-8 text-sm font-medium",cell:"h-8 w-8 text-slate-600"},mode:"single",selected:t,onSelect:e=>{r(e)},initialFocus:!0})})]})}const oe=e=>"object"==typeof e?e.path:e,se=({selected:e,onRemove:t,onClearAll:r})=>{const a=e.slice().sort((e,t)=>{const r="object"==typeof e?e.label:e,a="object"==typeof t?t.label:t;return r.localeCompare(a)});return c("div",{className:"relative flex items-center justify-between px-4 pt-2 pb-4 gap-2 border-b pr-8",children:[m("div",{className:"flex flex-wrap gap-2",children:a.map(e=>c("span",{onClick:r=>{r.stopPropagation(),t(e)},className:"flex items-center bg-primary-400/10 text-[10px] px-1 py-0.5 rounded-sm cursor-pointer hover:bg-gray-200 transition",children:["object"==typeof e?e.label:e,m(d,{icon:"close",className:"h-2 w-2 ml-1 text-primary-600"})]},oe(e)))}),m("div",{onClick:e=>{e.stopPropagation(),r()},className:"absolute top-1 right-2 cursor-pointer",children:m(E,{tooltipText:"Clear all",icon:"close",className:"h-4 w-4 mr-1 text-gray-500 hover:text-gray-800 transition"})})]})},ne=({options:e,selected:t,onOptionSelect:r,className:a,multiple:l,isSmall:o,optionTooltip:s})=>{const n=e.slice().sort((e,t)=>{var r,a;const l=(null===(r=e.label)||void 0===r?void 0:r.toLowerCase())??"",o=(null===(a=t.label)||void 0===a?void 0:a.toLowerCase())??"";return l.localeCompare(o)});return m("div",{className:S(a),children:n.map((e,a)=>{if(e.isLoading)return m(J,{value:e.label,className:"px-4 py-2 text-sm text-gray-500 cursor-default",disabled:!0,children:c("div",{className:"flex items-center gap-2",children:[m(_,{className:"w-4 h-4"}),m("span",{children:e.label})]})},"loading-state");const n=l||o?t.some(t=>oe(t)===oe(e)):t&&oe(t)===oe(e);if(e.options)return m(K,{className:"px-2 mt-2 overflow-visible",heading:m("span",{className:"cursor-default font-bold text-sm text-gray-800 whitespace-nowrap",children:e.label}),children:m(ne,{options:e.options,selected:t,onOptionSelect:r,multiple:l,isSmall:o,optionTooltip:s})},a);{const t=m(J,{value:e.label,className:S("px-4 cursor-pointer hover:bg-gray-100 font-light border-b border-gray-100 whitespace-nowrap",n&&"bg-primary-400/10"),onSelect:()=>r(e),children:c("div",{className:"flex justify-between items-center w-full gap-2",children:[m("span",{className:"whitespace-nowrap",children:e.label}),n&&m(d,{icon:"check",className:"text-primary-600 h-3 w-3 ml-2 flex-shrink-0"})]})},a);if(s){const r="function"==typeof s?s(e):null==s?void 0:s[e.path];return r?m(E,{tooltipText:r,side:"right",children:t},a):t}return t}})})},ie=({options:e,selected:t=[],onSelect:a,trigger:l,children:o,className:s,multiple:n=!1,isSearchable:i=!0,isSmall:d=!1,isShadow:u=!0,showSelectedSummary:p=!0,onSearchChange:f,searchPlaceholder:h="Search...",shouldFilter:y=!0,optionTooltip:g,searchFields:x=["label"]})=>{const[b,v]=r(!1),[N,w]=r(""),C=y?((e,t)=>{if(!t)return e;const r=t.toLowerCase(),a=(e=>{const t=[],r=e=>{e.forEach(e=>{e.options?r(e.options):e.isLoading||t.push(e)})};return r(e),t})(e).filter(e=>x.some(t=>{var a;return null===(a=e[t])||void 0===a?void 0:a.toLowerCase().includes(r)})),l=new Set(a.map(e=>e.path)),o=e=>e.map(e=>{if(e.options){const r=((e,t)=>e.toLowerCase().includes(t.toLowerCase()))(e.label,t);if(r)return{...e,matchedGroup:!0};const a=o(e.options);return a.length>0?{...e,options:a,matchedGroup:!1}:null}return e.isLoading||l.has(e.path)?e:null}).filter(Boolean);return o(e)})(e,N):e,k=e=>{if(n){const r=t.some(t=>oe(t)===oe(e))?t.filter(t=>oe(t)!==oe(e)):[...t,e];a(r)}else a(e),v(!1)};return m("div",{className:S("relative flex",s),children:c(I,{open:b,onOpenChange:v,children:[m(L,{asChild:!0,className:"flex items-center gap-1 text-gray-500 text-sm "+(d?"border-none px-1 text-xs py-0":"border-b px-2 py-1"),children:o||l(t)}),m(j,{align:"start",sideOffset:4,className:S("bg-white border w-auto",!u&&"shadow-none"),children:m(W,{children:c($,{shouldFilter:!1,children:[i&&m(H,{placeholder:h,className:"px-4 py-2 mb-2 border-b border-gray-300",onValueChange:e=>{w(e),f&&f(e)}}),c(q,{children:[n&&t.length>0&&("always"===p||!1!==p&&e.length>6)&&m(se,{selected:t,onRemove:k,onClearAll:()=>a([])}),m(ne,{options:C,selected:t,onOptionSelect:k,multiple:n,isSmall:d,optionTooltip:g}),0===C.length&&m(Q,{})]})]})})})]})})},de={number:["<",">","<=",">="],string:["contains","beginswith"],date:["<",">","<=",">="],boolean:[],select:[],__all__:["=","!="]},ce={number:"number",string:"text",date:"date"},me=({removeFilter:e,filter:t,keys:r,types:l,handleFilterChange:o,options:s,keysMeta:n})=>{var i;const{key:u,id:p,operator:f,value:h}=t,y=a(()=>u&&l[u],[u,l]),g=a(()=>y?[...de.__all__,...de[y]]:de.__all__,[y]),x=a(()=>ce[y]||"text",[y]),b=a(()=>{var e;return"select"===y&&null!=s&&null!==(e=s[u])&&void 0!==e&&e.length?s[u]:[]},[y,s,u]),v=a(()=>"date"===y&&h?Y(h,"date"):null,[y,h]),N=(e,t)=>{let r;r="key"===e?{[e]:t,operator:"=",value:Y("",l[t])}:{[e]:t},o(p,r)};return c("div",{className:"flex gap-2 items-center w-full",children:[c("div",{className:"flex gap-4 items-center w-full",children:[m("div",{className:"flex-shrink-0 w-[200px]",children:m(ie,{selected:u,onSelect:e=>N("key",e.path),options:r,children:c("button",{className:"border-b-[1px] pl-2 text-sm focus:ring-0 flex items-center w-full h-9",children:[m(d,{icon:"sort",className:"h-3 w-3"}),m("span",{className:"truncate",children:null===(i=n[u])||void 0===i?void 0:i.label})]})})}),m("div",{className:"flex-shrink-0 w-[75px]",children:c(G,{onValueChange:e=>N("operator",e),value:f,children:[m(z,{iconClassName:"h-3 w-3 text-gray-500",className:"border-0 border-b-[1px] shadow-none focus:ring-0 text-sm pl-0 text-gray-600 w-full",children:m(T,{className:"text-slate-700 truncate",placeholder:"Select"})}),m(B,{className:"text-slate-700",children:g.map(e=>m(V,{value:e,children:e},e))})]})}),c("div",{className:"flex-1",children:["select"===y&&m(ie,{options:b,selected:n[u].multiple?Array.isArray(h)?h.map(e=>b.find(t=>t.path===e)||e):[]:b.find(e=>e.path===h)||h,onSelect:e=>{const t=Array.isArray(e)?e.map(e=>e.path??e):e.path??e;N("value",t)},multiple:n[u].multiple??!1,isSearchable:!0,isSmall:!1,showSelectedSummary:!1,trigger:e=>{var t;return((e,t,r,a,l,o)=>m(R,{selected:e,leftIcon:t,rightIcon:r,className:a,iconClassName:l,placeholder:o,maxWidth:"flex-1"}))(e,"sort",null,"border-b-[1px] pl-2 text-sm focus:ring-0 flex items-center w-full h-9","mr-2",n[u].multiple?"Select":(null===(t=b.find(e=>e.path===h))||void 0===t?void 0:t.label)||"Select")}}),"date"===y&&m(le,{placeholder:"Enter a date",value:v,format:"yyyy MMM dd",onChange:e=>N("value",e),className:"w-full text-sm",calendarClassName:"border-t-2 border-primary-600"},"date"),"boolean"===y&&m("div",{className:"flex justify-center items-center h-full text-center",children:m(E,{tooltipText:"Toggle to enable or disable",className:"mr-2 text-gray-500",children:m(U,{onCheckedChange:e=>N("value",!!e),checked:!!h,className:"w-10 h-4.5 rounded-full border-transparent transition-colors data-[state=checked]:bg-primary-700 data-[state=unchecked]:bg-gray-500",thumbStyle:"w-4 h-4 bg-white rounded-full shadow-md transform transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0"})})}),("string"===y||"number"===y)&&m(D,{defaultValue:h,placeholder:"Enter a value",onBlur:e=>{var t;return N("value",Y(null==e||null===(t=e.target)||void 0===t?void 0:t.value,y))},type:x,className:"pl-2 bg-transparent text-sm rounded-none border-t-0 border-r-0 border-b-[1px] border-l-0 focus:ring-2 focus:ring-primary-500 focus:border-transparent h-9 w-full"})]})]}),m(E,{tooltipText:"Remove item",children:m("div",{onClick:()=>e(p),className:"cursor-pointer",children:m(d,{icon:"multiply"})})})]})},ue=()=>{var e;return null===(e=crypto)||void 0===e?void 0:e.randomUUID()},pe=(e={},t)=>({id:ue(),...t,...e,isGroup:!1}),fe=(e=[],t="and")=>({id:ue(),isGroup:!0,operator:t.toLowerCase(),rules:e}),he=({onAddCondition:e,onAddGroup:t,canAddGroup:r=!0,level:a=0})=>{const l=a>=2,o="text-gray-600 font-medium cursor-pointer hover:text-primary-600 text-sm";return c("div",{className:"flex gap-4",children:[m("span",{className:o,onClick:e,children:"+ Add condition"}),r&&(l?m(E,{tooltipText:"Filter condition can only be nested three level deep",children:m("span",{className:"text-gray-400 text-sm cursor-not-allowed",children:"+ Add condition group"})}):m("span",{className:o,onClick:t,children:"+ Add condition group"}))]})},ye=({value:e,onChange:t})=>c(G,{defaultValue:e.toUpperCase(),onValueChange:e=>t(e.toLowerCase()),children:[m(z,{iconClassName:"h-3 w-3 text-gray-500",className:"border-0 border-b-[1px] shadow-none focus:ring-0 text-sm pl-0 text-gray-600 w-[55px]",children:m(T,{})}),c(B,{children:[m(V,{value:"AND",children:"and"}),m(V,{value:"OR",children:"or"})]})]}),ge=({group:e,onChange:t,onRemove:r,keys:a,types:l,options:o,defaultCondition:s,keysMeta:n,level:i=0,isRoot:u=!1})=>{const p=e.rules||[],f=e.operator||e.logic||"and",h=(r,a)=>{const l=p.map(e=>e.id===r?a:e);t({...e,rules:l})},y=r=>{const a=p.filter(e=>e.id!==r);t({...e,rules:a})},g=r=>{t({...e,rules:[...p,r]})},x=r=>{t({...e,operator:r.toLowerCase()})},b=!u,v=!u,N=0===p.length;return c("div",{className:S("flex flex-col gap-4",b&&"rounded-sm py-2 px-4 border bg-gray-100"),children:[N&&v&&m("div",{className:"text-sm font-light",children:"Add conditions or sub-groups."}),p.map((e,t)=>c("div",{className:"flex gap-2 items-start",children:[0===t?m("span",{className:"w-[55px] pt-2 text-sm font-medium text-gray-700",children:"Where"}):1===t?m(ye,{value:f,onChange:x}):m("span",{className:"w-[55px] pt-2 text-sm text-gray-700",children:f}),m("div",{className:"flex-1",children:e.isGroup?m(ge,{group:e,onChange:t=>h(e.id,t),onRemove:()=>y(e.id),keys:a,types:l,options:o,defaultCondition:s,keysMeta:n,level:i+1,isRoot:!1}):m(me,{filter:e,handleFilterChange:(t,r)=>h(e.id,{...e,...r}),removeFilter:()=>y(e.id),types:l,keys:a,options:o,keysMeta:n})})]},e.id)),v&&c("div",{className:"flex justify-between gap-10 items-center pt-2 border-t border-gray-200",children:[m(he,{onAddCondition:()=>g(pe({},s)),onAddGroup:()=>g(fe()),level:i}),m(E,{tooltipText:"Remove group",children:m("button",{onClick:r,className:"text-gray-600 hover:text-gray-900 transition-colors",children:m(d,{icon:"multiply"})})})]})]})},xe=({onAddCondition:e,onAddGroup:t})=>c("div",{className:"flex gap-6",children:[m("span",{className:"text-gray-600 font-medium cursor-pointer hover:text-primary-600 text-sm",onClick:e,children:"+ Add condition"}),m("span",{className:"text-gray-600 font-medium cursor-pointer hover:text-primary-600 text-sm",onClick:t,children:"+ Add condition group"})]}),be=e=>{if(!e)return null;if(!e.isGroup){const{id:t,isGroup:r,...a}=e;return a.key&&a.operator?a:null}const t=(e.rules||[]).map(e=>be(e)).filter(Boolean);return 0===t.length?null:{operator:e.operator||"and",rules:t}},ve=e=>{return e&&e.operator&&Array.isArray(e.rules)?{id:null===(t=crypto)||void 0===t?void 0:t.randomUUID(),isGroup:!0,operator:e.operator,rules:e.rules.map(e=>{return e.operator&&e.rules?ve(e):{id:null===(t=crypto)||void 0===t?void 0:t.randomUUID(),isGroup:!1,...e};var t})}:null;var t},Ne=({keys:e,types:t,initialFilters:a,updateFilters:o,options:s,defaultCondition:n,keysMeta:i,closePopover:p})=>{const[f,h]=r(()=>a?a.isGroup?a:ve(a):null),y=((null==f?void 0:f.rules)||[]).length>0,g=Boolean(f&&y),x=e=>{if(!f)return;const t=f.rules||[];h({...f,rules:[...t,e]})};return l(()=>{if(a){const e=a.isGroup?a:ve(a);h(e)}},[a]),c("div",{className:"text-slate-600 w-full",children:[c("div",{className:"flex items-center gap-2 mb-4",children:[m(d,{icon:"filter",className:"text-primary-700",size:"lg"}),m("h2",{className:"text-lg font-medium text-gray-800",children:"Filter"})]}),f?c(u,{children:[g&&m("div",{className:"flex gap-2 items-start mb-4",children:m("div",{className:"flex-1",children:m(ge,{group:f,onChange:h,onRemove:()=>h(null),keys:e,types:t,options:s,defaultCondition:n,keysMeta:i,level:0,isRoot:!0})})}),c("div",{className:"flex justify-between items-center gap-10",children:[m(xe,{onAddCondition:()=>x(pe({},n)),onAddGroup:()=>x(fe())}),c(M,{className:"rounded-sm shadow-sm text-xs transition-all hover:shadow-md",onClick:()=>{const e=be(f);o(e),p()},children:[m(d,{icon:"filter",className:"mr-1",size:"sm"}),m("span",{children:"Apply"})]})]})]}):m(xe,{onAddCondition:()=>{h(fe([pe({},n)]))},onAddGroup:()=>{const e=fe();h(fe([e]))}})]})};function we({className:e,closePopover:t,options:r,filterData:a,defaultCondition:l,filters:o,updateFilters:s,keysMeta:n}){return m("div",{className:S(e),children:m(Ne,{keys:(null==a?void 0:a.fields)||[],types:(null==a?void 0:a.types)||{},initialFilters:o,updateFilters:s,options:r,defaultCondition:l,keysMeta:n,closePopover:t})})}function Ce({options:e,filterData:t,defaultCondition:a,filters:l,updateFilters:o,keysMeta:s,filterProps:n}){const[i,u]=r(!1),p=n||{options:e,filterData:t,defaultCondition:a,filters:l,updateFilters:o,keysMeta:s},f=ae(p.filters);return p.filterData?c(I,{className:"z-10",style:{zIndex:10},open:i,onOpenChange:()=>u(!i),children:[m(L,{asChild:!0,children:c(M,{className:"rounded-sm h-10 w-10 text-lg shadow-lg relative",children:[m(d,{icon:"filter"}),f>0&&m("span",{className:"absolute top-0 right-0 text-xs bg-primary-600 text-white rounded-full w-5 h-5 flex items-center justify-center text-center -mr-2 -mt-2",children:f})]})}),m(j,{className:"max-w-[60vw] w-auto max-h-[70vh] overflow-y-auto rounded-none bg-gray-50 border-t-2 border-t-primary-700 p-6",children:m(W,{children:m(we,{closePopover:()=>u(!1),options:p.options,filterData:p.filterData,defaultCondition:p.defaultCondition,filters:p.filters,updateFilters:p.updateFilters,keysMeta:p.keysMeta})})})]}):null}function ke(e=[],t=null){var l;const[o,s]=r(null),n=a(()=>{var e,r;if(null==t||!t.fields)return{fieldMeta:null,keysMeta:{},filterData:null,defaultCondition:null};const{fields:a}=t,l={all:{map:a.reduce((e,t)=>(e[t.path]={label:t.label,type:t.type||"string"},e),{})}},o=a.reduce((e,t)=>(e[t.path]={label:t.label,type:t.type||"string",multiple:!1},e),{});return{fieldMeta:l,keysMeta:o,filterData:{types:a.reduce((e,t)=>(e[t.path]=t.type||"string",e),{}),fields:a},defaultCondition:t.defaultCondition?{id:t.defaultCondition.key,key:t.defaultCondition.key,label:(null===(e=o[t.defaultCondition.key])||void 0===e?void 0:e.label)||t.defaultCondition.key,operator:t.defaultCondition.operator,value:t.defaultCondition.value,type:(null===(r=o[t.defaultCondition.key])||void 0===r?void 0:r.type)||"string",isGroup:!1}:null}},[t]),i=a(()=>o&&n.fieldMeta?re(e,o,null,n.fieldMeta):e,[e,o,n.fieldMeta]),d=a(()=>!!o&&(Array.isArray(o)?o.length>0:!!o.rules&&o.rules.length>0),[o]),c=n.filterData?{filterData:n.filterData,defaultCondition:n.defaultCondition,filters:o,updateFilters:s,keysMeta:n.keysMeta}:null;return{filteredData:i,filters:o,setFilters:s,filterProps:c,clearFilters:()=>s(null),hasActiveFilters:d,filterCount:d?Array.isArray(o)?o.length:(null===(l=o.rules)||void 0===l?void 0:l.length)||0:0}}export{Ce as FilterPopover,re as applyFilterFn,ke as useFilter};
//# sourceMappingURL=index.esm.js.map
