{"version":3,"file":"index.esm.js","sources":["../src/RichSelect.js"],"sourcesContent":["// RichSelect.js\r\n\"use client\"\r\n\r\nimport { useState } from \"react\"; // <- no direct React import for library bundling\r\nimport { Popover, PopoverTrigger, PopoverContent } from \"@ankamala/core\";\r\nimport {\r\n  CommandLibrary,\r\n  CommandList,\r\n  CommandItem,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandEmpty,\r\n} from \"@ankamala/core\";\r\nimport { cn, Spinner } from \"@ankamala/core\";\r\nimport { FAIcon } from \"@ankamala/core\";\r\nimport { Tooltip, TooltipProvider } from \"@ankamala/core\";\r\n// Helpers\r\nconst getOptionValue = (option) => (typeof option === \"object\" ? option.path : option);\r\n\r\nconst SelectedOptionsDisplay = ({ selected, onRemove, onClearAll }) => {\r\n  const sortedSelected = selected.slice().sort((a, b) => {\r\n    const labelA = typeof a === \"object\" ? a.label : a;\r\n    const labelB = typeof b === \"object\" ? b.label : b;\r\n    return labelA.localeCompare(labelB);\r\n  });\r\n\r\n  return (\r\n    <div className=\"relative flex items-center justify-between px-4 pt-2 pb-4 gap-2 border-b pr-8\">\r\n      <div className=\"flex flex-wrap gap-2\">\r\n        {sortedSelected.map((option) => (\r\n          <span\r\n            key={getOptionValue(option)}\r\n            onClick={(e) => {\r\n              e.stopPropagation();\r\n              onRemove(option);\r\n            }}\r\n            className=\"flex items-center bg-primary-400/10 text-[10px] px-1 py-0.5 rounded-sm cursor-pointer hover:bg-gray-200 transition\"\r\n          >\r\n            {typeof option === \"object\" ? option.label : option}\r\n            <FAIcon icon=\"close\" className=\"h-2 w-2 ml-1 text-primary-600\" />\r\n          </span>\r\n        ))}\r\n      </div>\r\n      <div\r\n        onClick={(e) => {\r\n          e.stopPropagation();\r\n          onClearAll();\r\n        }}\r\n        className=\"absolute top-1 right-2 cursor-pointer\"\r\n      >\r\n        <Tooltip\r\n          tooltipText=\"Clear all\"\r\n          icon=\"close\"\r\n          className=\"h-4 w-4 mr-1 text-gray-500 hover:text-gray-800 transition\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst RecursiveOptions = ({ options, selected, onOptionSelect, className, multiple, isSmall, optionTooltip }) => {\r\n  return (\r\n    <div className={cn(className)}>\r\n      {options.map((option, index) => {\r\n        if (option.isLoading) {\r\n          return (\r\n            <CommandItem\r\n              key=\"loading-state\"\r\n              value={option.label}\r\n              className=\"px-4 py-2 text-sm text-gray-500 cursor-default\"\r\n              disabled\r\n            >\r\n              <div className=\"flex items-center gap-2\">\r\n                <Spinner className=\"w-4 h-4\" />\r\n                <span>{option.label}</span>\r\n              </div>\r\n            </CommandItem>\r\n          );\r\n        }\r\n\r\n        const isSelected =\r\n          multiple || isSmall\r\n            ? selected.some((item) => getOptionValue(item) === getOptionValue(option))\r\n            : selected && getOptionValue(selected) === getOptionValue(option);\r\n\r\n        if (option.options) {\r\n          return (\r\n            <CommandGroup\r\n              className=\"px-2 mt-2 overflow-visible\"\r\n              key={index}\r\n              heading={<span className=\"cursor-default font-bold text-sm text-gray-800 whitespace-nowrap\">{option.label}</span>}\r\n            >\r\n              <RecursiveOptions\r\n                options={option.options}\r\n                selected={selected}\r\n                onOptionSelect={onOptionSelect}\r\n                multiple={multiple}\r\n                isSmall={isSmall}\r\n                optionTooltip={optionTooltip}\r\n              />\r\n            </CommandGroup>\r\n          );\r\n        } else {\r\n          const content = (\r\n            <CommandItem\r\n              key={index}\r\n              value={option.label}\r\n              className={cn(\r\n                \"px-4 cursor-pointer hover:bg-gray-100 font-light border-b border-gray-100 whitespace-nowrap\",\r\n                isSelected && \"bg-primary-400/10\"\r\n              )}\r\n              onSelect={() => onOptionSelect(option)}\r\n            >\r\n              <div className=\"flex justify-between items-center w-full gap-2\">\r\n                <span className=\"whitespace-nowrap\">{option.label}</span>\r\n                {isSelected && <FAIcon icon=\"check\" className=\"text-primary-600 h-3 w-3 ml-2 flex-shrink-0\" />}\r\n              </div>\r\n            </CommandItem>\r\n          );\r\n\r\n          if (optionTooltip) {\r\n            const tooltipText =\r\n              typeof optionTooltip === \"function\" ? optionTooltip(option) : optionTooltip?.[option.path];\r\n\r\n            return tooltipText ? (\r\n              <Tooltip key={index} tooltipText={tooltipText} side=\"right\">\r\n                {content}\r\n              </Tooltip>\r\n            ) : (\r\n              content\r\n            );\r\n          }\r\n\r\n          return content;\r\n        }\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nconst RichSelect = ({\r\n  options,\r\n  selected = [],\r\n  onSelect,\r\n  trigger,\r\n  children,\r\n  className,\r\n  multiple = false,\r\n  isSearchable = true,\r\n  isSmall = false,\r\n  isShadow = true,\r\n  showSelectedSummary = true,\r\n  onSearchChange,\r\n  searchPlaceholder = \"Search...\",\r\n  shouldFilter = true,\r\n  optionTooltip,\r\n  searchFields = ['label'],\r\n}) => {\r\n  const [openMain, setOpenMain] = useState(false);\r\n  const [searchValue, setSearchValue] = useState(\"\");\r\n\r\n  const flattenOptions = (opts) => {\r\n    const flattened = [];\r\n    const traverse = (items) => {\r\n      items.forEach(item => {\r\n        if (item.options) traverse(item.options);\r\n        else if (!item.isLoading) flattened.push(item);\r\n      });\r\n    };\r\n    traverse(opts);\r\n    return flattened;\r\n  };\r\n\r\n  const groupMatchesSearch = (groupLabel, search) => groupLabel.toLowerCase().includes(search.toLowerCase());\r\n\r\n  const filterOptions = (opts, search) => {\r\n    if (!search) return opts;\r\n    const searchLower = search.toLowerCase();\r\n    const flatMatches = flattenOptions(opts).filter(opt =>\r\n      searchFields.some(field => opt[field]?.toLowerCase().includes(searchLower))\r\n    );\r\n    const matchPaths = new Set(flatMatches.map(opt => opt.path));\r\n\r\n    const filterRecursive = (items) =>\r\n      items.map(item => {\r\n        if (item.options) {\r\n          const groupMatches = groupMatchesSearch(item.label, search);\r\n          if (groupMatches) return { ...item, matchedGroup: true };\r\n          const filteredChildren = filterRecursive(item.options);\r\n          if (filteredChildren.length > 0) return { ...item, options: filteredChildren, matchedGroup: false };\r\n          return null;\r\n        } else if (item.isLoading || matchPaths.has(item.path)) return item;\r\n        return null;\r\n      }).filter(Boolean);\r\n\r\n    return filterRecursive(opts);\r\n  };\r\n\r\n  const filteredOptions = shouldFilter ? filterOptions(options, searchValue) : options;\r\n\r\n  const handleOptionSelect = (option) => {\r\n    if (multiple) {\r\n      const isSelected = selected.some((item) => getOptionValue(item) === getOptionValue(option));\r\n      const newSelected = isSelected\r\n        ? selected.filter((item) => getOptionValue(item) !== getOptionValue(option))\r\n        : [...selected, option];\r\n      onSelect(newSelected);\r\n    } else {\r\n      onSelect(option);\r\n      setOpenMain(false);\r\n    }\r\n  };\r\n\r\n  const handleSearchChange = (value) => {\r\n    setSearchValue(value);\r\n    if (onSearchChange) onSearchChange(value);\r\n  };\r\n\r\n  return (\r\n    <div className={cn(\"relative flex\", className)}>\r\n      <Popover open={openMain} onOpenChange={setOpenMain}>\r\n        <PopoverTrigger\r\n          asChild\r\n          className={`flex items-center gap-1 text-gray-500 text-sm ${\r\n            isSmall ? \"border-none px-1 text-xs py-0\" : \"border-b px-2 py-1\"\r\n          }`}\r\n        >\r\n          {children ? children : trigger(selected)}\r\n        </PopoverTrigger>\r\n        <PopoverContent align=\"start\" sideOffset={4} className={cn(\"bg-white border w-auto\", !isShadow && \"shadow-none\")}>\r\n              <TooltipProvider>\r\n\r\n          <CommandLibrary shouldFilter={false}>\r\n            {isSearchable && (\r\n              <CommandInput\r\n                placeholder={searchPlaceholder}\r\n                className=\"px-4 py-2 mb-2 border-b border-gray-300\"\r\n                onValueChange={handleSearchChange}\r\n              />\r\n            )}\r\n\r\n            <CommandList>\r\n              {multiple && selected.length > 0 &&\r\n                (showSelectedSummary === \"always\" || (showSelectedSummary !== false && options.length > 6)) && (\r\n                  <SelectedOptionsDisplay\r\n                    selected={selected}\r\n                    onRemove={handleOptionSelect}\r\n                    onClearAll={() => onSelect([])}\r\n                  />\r\n                )}\r\n\r\n              <RecursiveOptions\r\n                options={filteredOptions}\r\n                selected={selected}\r\n                onOptionSelect={handleOptionSelect}\r\n                multiple={multiple}\r\n                isSmall={isSmall}\r\n                optionTooltip={optionTooltip}\r\n              />\r\n\r\n              {filteredOptions.length === 0 && <CommandEmpty />}\r\n            </CommandList>\r\n          </CommandLibrary>\r\n              </TooltipProvider>\r\n\r\n        </PopoverContent>\r\n      </Popover>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RichSelect;\r\n"],"names":["getOptionValue","option","path","SelectedOptionsDisplay","selected","onRemove","onClearAll","sortedSelected","slice","sort","a","b","labelA","label","labelB","localeCompare","_jsxs","className","children","_jsx","map","onClick","e","stopPropagation","FAIcon","icon","Tooltip","tooltipText","RecursiveOptions","options","onOptionSelect","multiple","isSmall","optionTooltip","cn","index","isLoading","CommandItem","value","disabled","Spinner","isSelected","some","item","CommandGroup","heading","content","onSelect","side","RichSelect","trigger","isSearchable","isShadow","showSelectedSummary","onSearchChange","searchPlaceholder","shouldFilter","searchFields","openMain","setOpenMain","useState","searchValue","setSearchValue","filteredOptions","filterOptions","opts","search","searchLower","toLowerCase","flatMatches","flattened","traverse","items","forEach","push","flattenOptions","filter","opt","field","_opt$field","includes","matchPaths","Set","filterRecursive","groupMatches","groupMatchesSearch","groupLabel","matchedGroup","filteredChildren","length","has","Boolean","handleOptionSelect","newSelected","Popover","open","onOpenChange","PopoverTrigger","asChild","PopoverContent","align","sideOffset","TooltipProvider","CommandLibrary","CommandInput","placeholder","onValueChange","CommandList","CommandEmpty"],"mappings":"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"}