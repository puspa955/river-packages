import{useState as e}from"react";import{cn as t,Popover as l,PopoverTrigger as o,PopoverContent as r,TooltipProvider as a,CommandLibrary as s,CommandInput as n,CommandList as i,CommandEmpty as c,FAIcon as p,Tooltip as d,CommandItem as m,Spinner as h,CommandGroup as u}from"@ankamala/core";import{jsx as b,jsxs as f}from"react/jsx-runtime";const g=e=>"object"==typeof e?e.path:e,x=({selected:e,onRemove:t,onClearAll:l})=>{const o=e.slice().sort((e,t)=>{const l="object"==typeof e?e.label:e,o="object"==typeof t?t.label:t;return l.localeCompare(o)});return f("div",{className:"relative flex items-center justify-between px-4 pt-2 pb-4 gap-2 border-b pr-8",children:[b("div",{className:"flex flex-wrap gap-2",children:o.map(e=>f("span",{onClick:l=>{l.stopPropagation(),t(e)},className:"flex items-center bg-primary-400/10 text-[10px] px-1 py-0.5 rounded-sm cursor-pointer hover:bg-gray-200 transition",children:["object"==typeof e?e.label:e,b(p,{icon:"close",className:"h-2 w-2 ml-1 text-primary-600"})]},g(e)))}),b("div",{onClick:e=>{e.stopPropagation(),l()},className:"absolute top-1 right-2 cursor-pointer",children:b(d,{tooltipText:"Clear all",icon:"close",className:"h-4 w-4 mr-1 text-gray-500 hover:text-gray-800 transition"})})]})},y=({options:e,selected:l,onOptionSelect:o,className:r,multiple:a,isSmall:s,optionTooltip:n})=>b("div",{className:t(r),children:e.map((e,r)=>{if(e.isLoading)return b(m,{value:e.label,className:"px-4 py-2 text-sm text-gray-500 cursor-default",disabled:!0,children:f("div",{className:"flex items-center gap-2",children:[b(h,{className:"w-4 h-4"}),b("span",{children:e.label})]})},"loading-state");const i=a||s?l.some(t=>g(t)===g(e)):l&&g(l)===g(e);if(e.options)return b(u,{className:"px-2 mt-2 overflow-visible",heading:b("span",{className:"cursor-default font-bold text-sm text-gray-800 whitespace-nowrap",children:e.label}),children:b(y,{options:e.options,selected:l,onOptionSelect:o,multiple:a,isSmall:s,optionTooltip:n})},r);{const l=b(m,{value:e.label,className:t("px-4 cursor-pointer hover:bg-gray-100 font-light border-b border-gray-100 whitespace-nowrap",i&&"bg-primary-400/10"),onSelect:()=>o(e),children:f("div",{className:"flex justify-between items-center w-full gap-2",children:[b("span",{className:"whitespace-nowrap",children:e.label}),i&&b(p,{icon:"check",className:"text-primary-600 h-3 w-3 ml-2 flex-shrink-0"})]})},r);if(n){const t="function"==typeof n?n(e):null==n?void 0:n[e.path];return t?b(d,{tooltipText:t,side:"right",children:l},r):l}return l}})}),w=({options:p,selected:d=[],onSelect:m,trigger:h,children:u,className:w,multiple:v=!1,isSearchable:N=!0,isSmall:S=!1,isShadow:C=!0,showSelectedSummary:j=!0,onSearchChange:L,searchPlaceholder:T="Search...",shouldFilter:k=!0,optionTooltip:O,searchFields:F=["label"]})=>{const[P,A]=e(!1),[G,R]=e(""),B=k?((e,t)=>{if(!t)return e;const l=t.toLowerCase(),o=(e=>{const t=[],l=e=>{e.forEach(e=>{e.options?l(e.options):e.isLoading||t.push(e)})};return l(e),t})(e).filter(e=>F.some(t=>{var o;return null===(o=e[t])||void 0===o?void 0:o.toLowerCase().includes(l)})),r=new Set(o.map(e=>e.path)),a=e=>e.map(e=>{if(e.options){const l=((e,t)=>e.toLowerCase().includes(t.toLowerCase()))(e.label,t);if(l)return{...e,matchedGroup:!0};const o=a(e.options);return o.length>0?{...e,options:o,matchedGroup:!1}:null}return e.isLoading||r.has(e.path)?e:null}).filter(Boolean);return a(e)})(p,G):p,E=e=>{if(v){const t=d.some(t=>g(t)===g(e))?d.filter(t=>g(t)!==g(e)):[...d,e];m(t)}else m(e),A(!1)};return b("div",{className:t("relative flex",w),children:f(l,{open:P,onOpenChange:A,children:[b(o,{asChild:!0,className:"flex items-center gap-1 text-gray-500 text-sm "+(S?"border-none px-1 text-xs py-0":"border-b px-2 py-1"),children:u||h(d)}),b(r,{align:"start",sideOffset:4,className:t("bg-white border w-auto",!C&&"shadow-none"),children:b(a,{children:f(s,{shouldFilter:!1,children:[N&&b(n,{placeholder:T,className:"px-4 py-2 mb-2 border-b border-gray-300",onValueChange:e=>{R(e),L&&L(e)}}),f(i,{children:[v&&d.length>0&&("always"===j||!1!==j&&p.length>6)&&b(x,{selected:d,onRemove:E,onClearAll:()=>m([])}),b(y,{options:B,selected:d,onOptionSelect:E,multiple:v,isSmall:S,optionTooltip:O}),0===B.length&&b(c,{})]})]})})})]})})};export{w as RichSelect};
//# sourceMappingURL=index.esm.js.map
